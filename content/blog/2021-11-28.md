---
title: 利用R写入导出多个文件
tags:
  -baseS
categories: R
---

## 一、基础： 利用基本的包进行写入导出多个文件

```R
my_path="路径"
my_file_dir=list.files(path = my_path,pattern = "\\d.csv$",full.names = TRUE)
# regular expressions
# 方法1
my_df=NULL
for (i in 1:length(my_file_dir[i])){
  my_df=rbind(my_df,read.csv(file=my_file_dir[i]))
#my_df=bind_rows(my_df,read.csv(file = my_file.dir[i]))
}

# 方法2
my_df_list=lapply(X=my_file_dir,FUN=read.csv)
my_df2=do.call(rbind.data.frame,my_df_list)
```

```R
# store file separately
my_filename=gsub(".csv","",list.files(path=my_path,full.names=False,pattern="_\\d.csv$"))
for (i in 1:length(my_filename))assign(my_filename[i], read.csv(my_file_dir[i])) 
```

```R
# how to write multiple dataframe into one excel file
install.packages('openxlsx')
library('openxlsx')

my_worksheet=list('sheeta'=C02,
                  'sheetb'=cars,
                  'sheetc'=iris)
write.xlsx(my_worksheet,file="路径",overwrite=TRUE)
# 可以直接将我们的file写入
write.xlsx(my_df_list,file="路径",overwrite=TRUE)
```

## 二、进阶：批量读取excel数据并合并

步骤

1.获取批量数据文件的路径

2.循环机制批量读取

3.合并成一个数据文件

载入需要的包

```R
library(tidyverse)
library(readxl)
library(writexl)
```

**一、多个列名相同**

1.**数据在多个工作簿（即多个xlsx文件）**

```R
files = list.files("datas/", pattern = "xlsx", full.names = TRUE)#文件夹路径
df = map_dfr(files, read_xlsx)    # 批量读取+按行堆叠合并

df
```

注1：数据文件名可以随便，不需要规律命名。

注2：数据文件甚至可以嵌套多层文件夹，只需要设置参数 recursive = TRUE.

2.**数据在一个工作簿的多个工作表（1个xlsx文件，包含多个sheet）**

```R
path = "1-3月提奖额.xlsx"#路径要指定到文件名
df <- map_dfr(excel_sheets(path), 
              ~ read_xlsx(path, sheet = .x))  # 批量读取+按行堆叠合并     
```

注：同样，各个sheet可以随便起名，不需要规律命名。

3.**结果输出**

```R
write_xlsx(df, "新工作簿.xlsx")   
```

**二、多个列名不相同**

都是同样的批量读取，但合并时不能只是简单的按行堆叠，而是需要做数据连接（join），得到总的数据表。也分两种情况讨论：

1. **数据在多个工作簿（即多个xlsx文件）**

```R
files = list.files("datas/", pattern = "xlsx", full.names = TRUE)

df = map(files, read_xlsx) %>% 
  reduce(full_join, by = "人名")                  # 读入并依次做全连接

df
```

2. **数据在一个工作簿的多个工作表（1个xlsx文件，包含多个sheet）**

```R
path = "exercise/3-5月业绩.xlsx"
df <- map(excel_sheets(path), 
          ~ read_xlsx(path, sheet = .)) %>% 
  reduce(full_join, by = "人名")              # 读入并依次做全连接
```

3.**结果输出同上。**

###### 参考：

1. [【R语言】批量读取Excel数据并合并（升级版） - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/157420835)

本次遗留问题，当相同列的数据类型不相同时如何强行合并呢？？